<div class="detalhe-container container">
  <a routerLink="/home" class="btn-voltar">← Voltar para a lista</a>

  <div *ngIf="!receita; else showReceita">
    <p>Carregando detalhes da receita...</p>
  </div>

  <ng-template #showReceita>
    <header>
      <div class="header-info">
        <h1>{{ receita?.titulo }}</h1>
        <p>Por: {{ receita?.usuario?.nome }} | Data: {{ receita?.dataCriacao | date: 'dd/MM/yyyy' }}</p>
      </div>
      
      <div class="rating">
        Média de Avaliações: {{ receita?.mediaAvaliacoes ? (receita?.mediaAvaliacoes | number: '1.1-1') : 'N/A' }} ★
      </div>
      
      <button 
        class="btn-salvar" 
        (click)="toggleSalvarReceita()"
        [class.salva]="receitaEstaSalva">
        {{ receitaEstaSalva ? 'Remover dos Favoritos' : 'Favoritar Receita' }}
        </button>
    </header>

    <section class="classificacao">
      <h3>Avalie esta receita:</h3>
      <div class="estrelas">
        <span *ngFor="let i of [1, 2, 3, 4, 5]" 
              class="estrela"
              (mouseover)="setHoverNota(i)"
              (mouseleave)="setHoverNota(0)"
              (click)="setNota(i)"
              [class.cheia]="i <= (hoverNota || notaSelecionada)">
          ★
        </span>
      </div>
      <button (click)="classificar()" [disabled]="notaSelecionada === 0">
        Avaliar com {{ notaSelecionada }} estrela(s)
      </button>
    </section>

    <section class="descricao">
      <p>{{ receita?.descricao }}</p>
    </section>

    <section class="ingredientes">
      <h3>Ingredientes</h3>
      <ul>
        <li *ngFor="let item of receita?.ingredientes">
          {{ item.quantidade }} {{ item.unidade }} de {{ item.nomeIngrediente }}
        </li>
      </ul>
    </section>

    <section class="modo-preparo">
      <h3>Modo de Preparo</h3>
      <div [innerHTML]="(receita?.modoPreparo || '').split('\n').join('<br>')"></div>
    </section>

    <section class="tags-dieta" *ngIf="receita?.dieta && receita?.dieta !== 'Nenhuma'">
  <h3>Tags da Receita</h3>
  <div class="tag-lista">
    <span *ngFor="let tag of receita?.dieta?.split(', ')" class="tag-item">
      {{ tag }}
    </span>
  </div>
</section>

    <section class="nutricional" *ngIf="receita?.informacaoNutricional">
        <h3>Informações Nutricionais (Total)</h3>
        <ul class="nutri-lista">
          <li><strong>Calorias:</strong> {{ receita?.informacaoNutricional?.calorias | number: '1.0-0' }} kcal</li>
          <li><strong>Proteínas:</strong> {{ receita?.informacaoNutricional?.proteinas | number: '1.0-1' }} g</li>
          <li><strong>Carboidratos:</strong> {{ receita?.informacaoNutricional?.carboidratos | number: '1.0-1' }} g</li>
          <li><strong>Gorduras:</strong> {{ receita?.informacaoNutricional?.gorduras | number: '1.0-1' }} g</li>
          <li><strong>Gord. Saturada:</strong> {{ receita?.informacaoNutricional?.gorduraSaturada | number: '1.0-1' }} g</li>
          <li><strong>Açúcar:</strong> {{ receita?.informacaoNutricional?.acucar | number: '1.0-1' }} g</li>
          <li><strong>Fibra:</strong> {{ receita?.informacaoNutricional?.fibra | number: '1.0-1' }} g</li>
          <li><strong>Sódio:</strong> {{ receita?.informacaoNutricional?.sodio | number: '1.0-0' }} mg</li>
        </ul>
      </section>
      <section class="nutricional" *ngIf="!receita?.informacaoNutricional">
          <p><i>Informações nutricionais não disponíveis para esta receita.</i></p>
    </section>

    <section class="comentarios">
  <h3>Comentários</h3>
<div *ngIf="comentarios.length === 0">
      <p>Seja o primeiro a comentar!</p>
    </div>
  <div class="novo-comentario">
    <textarea 
      [(ngModel)]="novoComentarioTexto" 
      placeholder="Escreva seu comentário aqui..."
      rows="5"></textarea>
    <button (click)="adicionarComentario()" [disabled]="!novoComentarioTexto.trim()">
      Comentar
    </button>
  </div>

  <div class="lista-comentarios">
    

    <div *ngFor="let comentario of comentarios" class="comentario-card">
      <p><strong>{{ comentario.usuario.nome }}</strong> <span> em {{ comentario.dataCriacao | date: 'dd/MM/yyyy HH:mm' }}</span></p>
      <p>{{ comentario.texto }}</p>
    </div>
  </div>
</section>
  </ng-template>
</div>